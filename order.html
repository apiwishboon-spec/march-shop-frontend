<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Art&Ink Studio – Order</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">

    <!-- BRAND -->
    <h1 class="brand">
      <span class="brand-gradient">Art&Ink Studio</span>
    </h1>

    <p class="subtitle" id="item-text"></p>

    <!-- ERROR -->
    <div id="error" class="error" style="display:none"></div>

    <!-- CONTACT INFO -->
    <label class="label">
      Email address
      <input id="email" type="email" placeholder="you@example.com">
    </label>

    <label class="label">
      Phone number
      <input id="phone" type="tel" placeholder="xxx-xxx-xxxx">
    </label>

    <label class="label">
      Quantity
      <input id="qty" type="number" min="1" value="1">
      <span class="hint">Number of items you want to order</span>
    </label>

    <!-- PAYMENT -->
    <div class="payment-box">
      <h3>Scan to Pay</h3>

      <img
        src="https://raw.githubusercontent.com/apiwishboon-spec/runcatcher/refs/heads/main/static/spornserme.png"
        alt="QR Payment"
        class="qr-img"
      />

      <p class="hint">
        Scan the QR code, complete the payment, then upload your payment slip.
      </p>
    </div>

    <!-- SLIP UPLOAD -->
    <label class="label">
      Upload payment slip
      <input
        type="file"
        id="slip"
        accept="image/*"
        onchange="runOCR()"
      >
      <span class="hint">
        Please upload a clear slip with visible amount and QR code.
      </span>
    </label>

    <!-- OCR STATUS -->
    <div id="ocr-status" class="hint"></div>

    <!-- OCR RESULT -->
    <div id="ocr-result" class="ocr-box" style="display:none">
      <strong>OCR detected text:</strong>
      <pre id="ocr-text"></pre>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="button-row">
      <button class="btn-secondary" onclick="cancelOrder()">
        Cancel
      </button>

      <button
        class="btn-primary"
        id="submitBtn"
        onclick="submitOrder()"
      >
        <span class="btn-text">Submit order</span>
        <span class="btn-loader"></span>
      </button>
    </div>

  </div>

  <!-- OCR ENGINE -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <!-- MAIN APP LOGIC -->
  <script src="app.js"></script>

  <!-- PAGE SCRIPT -->
  <script>
    // Load order info
    const item = localStorage.getItem("item");
    const price = localStorage.getItem("price");

    if (item && price) {
      document.getElementById("item-text").textContent =
        `${item} — ฿${price} each`;
    }

    function cancelOrder() {
      localStorage.clear();
      location.href = "index.html";
    }

    // OCR FUNCTION
    async function runOCR() {
      const fileInput = document.getElementById("slip");
      const status = document.getElementById("ocr-status");
      const resultBox = document.getElementById("ocr-result");
      const textEl = document.getElementById("ocr-text");

      if (!fileInput.files.length) return;

      const image = fileInput.files[0];
      status.textContent = "Reading payment slip...";
      resultBox.style.display = "none";

      try {
        const { data } = await Tesseract.recognize(
          image,
          "tha+eng",
          {
            logger: m => {
              if (m.status === "recognizing text") {
                status.textContent =
                  `OCR progress: ${Math.round(m.progress * 100)}%`;
              }
            }
          }
        );

        const text = data.text;
        textEl.textContent = text;
        resultBox.style.display = "block";

        // Extract useful signals
        const amountMatch =
          text.match(/(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)/);
        const timeMatch =
          text.match(/\b\d{2}:\d{2}\b/);

        let summary = "OCR complete ✔";

        if (amountMatch) {
          summary += ` | Detected amount: ฿${amountMatch[1]}`;
        } else {
          summary += " | Amount not detected";
        }

        if (timeMatch) {
          summary += ` | Time: ${timeMatch[0]}`;
        }

        status.textContent = summary;

      } catch (err) {
        status.textContent =
          "OCR failed. Please try another image.";
        console.error(err);
      }
    }
  </script>

</body>
</html>
